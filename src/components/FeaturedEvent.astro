---
import { getCollection } from "astro:content";
const allEvents = await getCollection("schedule");
import { formatDates } from "@/utils.js";

interface Props {
    group?: string;
}

const { group } = Astro.props;

const featuredCandidates = allEvents
    .filter((e) => {
        if (!group) return true;
        return e.data.group.id === group;
    })
    .filter((e) => e.data.featured === true)
    .filter((e) => e.data.end > new Date(new Date().getTime()))
    .sort((a, b) => a.data.start.valueOf() - b.data.start.valueOf());
---

<div id="featured-event-container">
    {
        featuredCandidates.map((event) => (
            <a href={"/schedule/" + event.slug} class="event">
                <article
                    class="featured-candidate"
                    data-end={event.data.end.toISOString()}
                    hidden
                >
                    <div class="group-name">
                        FEATURED: {event.data.group.id.toUpperCase()}
                    </div>
                    <h3>{event.data.title}</h3>
                    <div class="time">
                        <time datetime={event.data.start.toISOString()}>
                            {formatDates(event.data.start, event.data.end)}
                        </time>
                    </div>
                    <div class="location">{event.data.location}</div>
                </article>
            </a>
        ))
    }
</div>

<script>
    document.addEventListener("astro:page-load", () => {
        const container = document.getElementById("featured-event-container");
        if (!container) return;

        const candidates = container.querySelectorAll(".featured-candidate");
        const now = new Date();

        for (const card of candidates) {
            const end = new Date(card.getAttribute("data-end"));
            if (end > now) {
                card.removeAttribute("hidden");
                break;
            }
        }
    });
</script>

<style>
    .group-name {
        color: var(--accent);
        font-weight: 700;
        letter-spacing: 0.05em;
        text-transform: uppercase;
    }

    .event {
        color: inherit;
        text-decoration: none;
    }

    .event:hover > .featured-candidate {
        border: 2px solid var(--accent);
    }

    .featured-candidate {
        padding: 2rem;
        min-height: 260px;
        background-color: var(--fg);
        color: var(--bg);
        border: 2px solid var(--border);
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    .event-time,
    .location {
        font-variant-numeric: tabular-nums;
        white-space: nowrap;
        font-size: 1rem;
    }

    *[hidden] {
        display: none !important;
    }

    h3 {
        font-size: 1.5rem;
    }

    a:hover {
        color: var(--bg) !important;
    }

    .link-button {
        margin-top: 1rem;
        align-self: start;
    }

    @media (max-width: 1000px) {
        .featured-candidate {
            min-height: unset;
        }

        .link-button {
            align-self: center;
        }
    }
</style>
