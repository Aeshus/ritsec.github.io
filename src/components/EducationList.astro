---
import { getCollection } from 'astro:content';
const education = await getCollection('education');

function compareTerms(termA, termB) {
  const [semA, yearA] = termA.split(' ');
  const [semB, yearB] = termB.split(' ');
  const valA = parseInt(yearA) + (semA === "Fall" ? 0.1 : 0);
  const valB = parseInt(yearB) + (semB === "Fall" ? 0.1 : 0);
  return valB - valA;
}

const sortedEducation = education.sort((a, b) => compareTerms(a.data.term, b.data.term));

console.log(sortedEducation);

const grouped = sortedEducation.reduce((acc, entry) => {
  const year = entry.data.term;
  if (!acc[year]) acc[year] = [];
  acc[year].push(entry);
  return acc;
}, {});
---

{Object.entries(grouped).map(([year, entries]) => (
  <section>
    <h2>{year}</h2>
    <div>
      {entries
      .sort((a, b) => b.data.week - a.data.week)
      .map((entry) => (
        <article>
          <h3>{entry.data.title}</h3>
          <div>
          <span class="week">Week {entry.data.week}</span>
          {entry.data.presenter &&
          <span class="presenter"> &middot; By: {entry.data.presenter}</span>
          }
          </div>
          <div class="description">{entry.data.description}</div>
          <div class="links">
            {entry.data.slideshow &&
            <a href={entry.data.slideshow}>
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><!-- Icon from Carbon by IBM - undefined --><path fill="currentColor" d="m25.7 9.3l-7-7c-.2-.2-.4-.3-.7-.3H8c-1.1 0-2 .9-2 2v24c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V10c0-.3-.1-.5-.3-.7M18 4.4l5.6 5.6H18zM24 28H8V4h8v6c0 1.1.9 2 2 2h6z"/><path fill="currentColor" d="M10 22h12v2H10zm0-6h12v2H10z"/></svg>
            </a>
            }
            {entry.data.video &&
            <a href={entry.data.video}>
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><!-- Icon from Carbon by IBM - undefined --><path fill="currentColor" d="M13 11v10l8-5z"/><path fill="currentColor" d="M28 6H4c-1.103 0-2 .898-2 2v16c0 1.103.897 2 2 2h24c1.103 0 2-.897 2-2V8c0-1.102-.897-2-2-2m0 18H4V8h24z"/></svg>
            </a>
            }
          </div>
        </article>
      ))}
    </div>
  </section>
))}

<style>
  section {
    max-width: var(--w-sm);
    margin-top: 1rem;
  }

  article {
    margin-top: 1rem;
    padding: 1rem;
    text-align: center;
    background: var(--bg);
    border: 1px solid var(--bg-surface-hover);
    border-radius: 0.5rem;
    box-shadow: 0 1px 3px 0 color-mix(in oklab, var(--fg) 10%, transparent), 0 1px 2px -1px color-mix(in oklab, var(--fg) 10%, transparent);
  }

  h3 {
    font-size: 1.5rem;
    margin-top: 0;
  }

  a {
    color: var(--fg);
    text-decoration: none;
    transition: all 0.1s ease;
  }

  a:hover,
  a:active,
  a:focus {
    color: var(--fg-primary);
  }
</style>
