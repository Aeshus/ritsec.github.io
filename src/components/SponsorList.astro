---
import { getCollection } from 'astro:content';
const sponsors = await getCollection('sponsors');
console.log(sponsors);
import type { ImageMetadata } from 'astro';
const images = import.meta.glob<{ default: ImageMetadata }>('/src/assets/sponsors/*')

const grouped = sponsors.reduce((acc, sponsor) => {
  const tier = sponsor.tier;
  if (!acc[tier]) acc[tier] = [];
  acc[tier].push(sponsor);
  return acc;
  }, {});
---

{Object.entries(grouped).map(([tier, entries]) => (
  <section>
    <h2>{tier}</h2>
    <div class="sponsors">
      {entries.map(({ data }) => (
        <article class="sponsor">
          <Image 
            src={images["/src/assets/sponsors/" + data.image]()} 
            alt={`${data.name}'s face`} 
            height="250px"
            loading="eager"
          />
          <h3>{data.id}</h3>
          <div class="links">
            <a href={data.url} target="_blank" rel="noopener noreferrer" title="LinkedIn">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><!-- Icon from Carbon by IBM - undefined --><path fill="currentColor" d="M26.2 4H5.8C4.8 4 4 4.8 4 5.7v20.5c0 .9.8 1.7 1.8 1.7h20.4c1 0 1.8-.8 1.8-1.7V5.7c0-.9-.8-1.7-1.8-1.7M11.1 24.4H7.6V13h3.5zm-1.7-13c-1.1 0-2.1-.9-2.1-2.1s.9-2.1 2.1-2.1c1.1 0 2.1.9 2.1 2.1s-1 2.1-2.1 2.1m15.1 12.9H21v-5.6c0-1.3 0-3.1-1.9-3.1S17 17.1 17 18.5v5.7h-3.5V13h3.3v1.5h.1c.5-.9 1.7-1.9 3.4-1.9c3.6 0 4.3 2.4 4.3 5.5v6.2z"/></svg>
            </a>
          </div>
        </article>
      ))}
    </div>
  </section>
))}

<style>
  h2 {
    text-align: center;
    margin-bottom: 1rem;
  }

  section {
    max-width: var(--w-lg);
  }

  h3 {
    margin-top: 0.75rem;
    font-size: 1rem;
  }

  :global(.people img) {
    width: 100%;
    height: auto;
    max-width: 100%;
    display: block;
    object-fit: cover;
    overflow: hidden;
    border-top-left-radius: 0.5rem;
    border-top-right-radius: 0.5rem;
  }

  .year {
    color: var(--fg-primary);
  }

  article {
    text-align: center;
    background: var(--bg);
    border: 1px solid var(--bg-surface-hover);
    border-radius: 0.5rem;
    width: 250px;
    box-shadow: 0 1px 3px 0 color-mix(in oklab, var(--fg) 10%, transparent), 0 1px 2px -1px color-mix(in oklab, var(--fg) 10%, transparent);
  }

  .people {
    display: flex;
    flex-flow: wrap;
    justify-content: center;
    gap: 1rem;
  }

  a {
    color: var(--fg);
    text-decoration: none;
    transition: all 0.1s ease;
  }

  a:hover,
  a:active,
  a:focus {
    color: var(--fg-primary);
  }
</style>
