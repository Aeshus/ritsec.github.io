---
import { getCollection } from 'astro:content';
import { Image } from "astro:assets";
const sponsors = await getCollection('sponsors');
import type { ImageMetadata } from 'astro';
const images = import.meta.glob<{ default: ImageMetadata }>('/src/assets/sponsors/*')

const groupedIndustry = sponsors.filter(s => s.data.type == "Company").reduce((acc, sponsor) => {
  const tier = sponsor.data.tier;
  if (!acc[tier]) acc[tier] = [];
  acc[tier].push(sponsor);
  return acc;
  }, {});

const groupedIndividuals = sponsors.filter(s => s.data.type == "Individual").reduce((acc, sponsor) => {
  const tier = sponsor.data.tier;
  if (!acc[tier]) acc[tier] = [];
  acc[tier].push(sponsor);
  return acc;
  }, {});
---

<h2>Industry Sponsors</h2>
{Object.entries(groupedIndustry).map(([tier, entries]) => (
  <section>
    <h3>{tier}</h3>
    <div class="sponsors">
      {entries.map(({ data }) => (
        <article class="sponsor">
          <Image 
            src={images["/src/assets/sponsors/" + data.image]()} 
            alt={`${data.id}'s logo`} 
            height="250px"
            width="250px"
            loading="eager"
          />
          <h4>{data.id}</h4>
          <div class="links">
            <a href={data.url} target="_blank" rel="noopener noreferrer" title="Website">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><!-- Icon from Carbon by IBM - undefined --><path fill="currentColor" d="M26 28H6a2.003 2.003 0 0 1-2-2V6a2.003 2.003 0 0 1 2-2h10v2H6v20h20V16h2v10a2.003 2.003 0 0 1-2 2"/><path fill="currentColor" d="M20 2v2h6.586L18 12.586L19.414 14L28 5.414V12h2V2z"/></svg>
            </a>
          </div>
        </article>
      ))}
    </div>
  </section>
))}

<h2>Individual Sponsors</h2>
{Object.entries(groupedIndividuals).map(([tier, entries]) => (
  <section>
    <h3>{tier}</h3>
    <div class="sponsors">
      {entries.map(({ data }) => (
        <article class="sponsor">
          <Image 
            src={images["/src/assets/sponsors/" + data.image]()} 
            alt={`${data.id}'s logo`} 
            height="250px"
            width="250px"
            loading="eager"
          />
          <h4>{data.id}</h4>
          <div class="links">
            <a href={data.url} target="_blank" rel="noopener noreferrer" title="Website">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><!-- Icon from Carbon by IBM - undefined --><path fill="currentColor" d="M26 28H6a2.003 2.003 0 0 1-2-2V6a2.003 2.003 0 0 1 2-2h10v2H6v20h20V16h2v10a2.003 2.003 0 0 1-2 2"/><path fill="currentColor" d="M20 2v2h6.586L18 12.586L19.414 14L28 5.414V12h2V2z"/></svg>
            </a>
          </div>
        </article>
      ))}
    </div>
  </section>
))}

<style>
  h3 {
    text-align: center;
    margin-bottom: 1rem;
    font-size: 2rem;
  }

  section {
    max-width: var(--w-lg);
  }

  h4 {
    margin-top: 0.75rem;
    font-size: 1rem;
  }

  :global(.sponsor img) {
    width: 250px;
    height: 250px;
    max-width: 100%;
    display: block;
    object-fit: contain;
    overflow: hidden;
    border-top-left-radius: 0.5rem;
    border-top-right-radius: 0.5rem;
    background-color: white;
    padding: 0.5rem;
  }

  .year {
    color: var(--fg-primary);
  }

  article {
    text-align: center;
    background: var(--bg);
    border: 1px solid var(--bg-surface-hover);
    border-radius: 0.5rem;
    width: 250px;
    box-shadow: 0 1px 3px 0 color-mix(in oklab, var(--fg) 10%, transparent), 0 1px 2px -1px color-mix(in oklab, var(--fg) 10%, transparent);
    transition: all 0.2s ease-in-out; 
  }

  article:hover,
  article:focus,
  article:focus-within {
    transform: translateY(-2px);
    box-shadow: 0 4px 10px 0 color-mix(in oklab, var(--fg) 12%, transparent), 0 2px 4px -2px color-mix(in oklab, var(--fg) 12%, transparent);
  }

  .sponsors {
    display: flex;
    flex-flow: wrap;
    justify-content: center;
    gap: 1rem;
  }

  a {
    color: var(--fg);
    text-decoration: none;
    transition: all 0.1s ease;
  }

  a:hover,
  a:active,
  a:focus {
    color: var(--fg-primary);
  }

  .links {
    padding: 0.125rem;
  }
</style>
