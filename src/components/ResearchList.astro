---
import { getCollection } from "astro:content";
import { formatDate } from "@/utils.js";

interface Props {
    group?: string;
    count?: number;
}

const { group, count = 9999999 } = Astro.props;

const allResearch = await getCollection("research");

const research = allResearch
    .filter((post) => {
        if (!group) return true;
        return post.data.group?.id?.toLowerCase() === group.toLowerCase();
    })
    .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
    .slice(0, count);
---

<div class="list">
    {
        research.map((post) => (
            <a
                href={import.meta.env.BASE_URL + "/research/" + post.slug}
                class="card"
            >
                <article class="card-content">
                    <div>
                        <time datetime={post.data.date.toISOString()}>
                            {formatDate(post.data.date)}
                        </time>

                        {post.data.group && (
                            <span>â€¢ {post.data.group.id.toUpperCase()}</span>
                        )}
                    </div>

                    <h3>{post.data.title}</h3>

                    <div>
                        {post.data.authors.length > 0 ? (
                            <span>
                                {post.data.authors
                                    .map((a) => a.name)
                                    .join(", ")}
                            </span>
                        ) : (
                            <span>RITSEC</span>
                        )}
                    </div>
                </article>
            </a>
        ))
    }

    {
        research.length === 0 && (
            <p>No research found, please check again later.</p>
        )
    }
</div>

<style>
    .list {
        flex-direction: column;
    }

    h3 {
        margin-bottom: 0;
    }
</style>
