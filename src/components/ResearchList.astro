---
import { getCollection } from "astro:content";

const allResearch = await getCollection("research");

interface Props {
    group?: string;
    count?: number;
}

const {
    group,
    count = 3,
} = Astro.props;

const featuredResearch = allResearch
    .filter((post) => {
        if (!group) return true; 
        return post.data.group?.id === group;
    })
    .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
    .slice(0, count);

const formatDate = (date: Date) => {
    return new Intl.DateTimeFormat("en-US", {
        timeZone: "UTC",
        year: "numeric",
        month: "short",
        day: "numeric",
    }).format(date);
};
---

<div class="research-grid">
    {
        featuredResearch.map((post) => (
            <a href={"/research/" + post.slug} class="research-link">
                <article class="research-card">
                    
                    <div class="card-meta">
                        <time datetime={post.data.date.toISOString()} class="mono-date">
                            {formatDate(post.data.date)}
                        </time>

                        {post.data.group && (
                            <span class="group-badge">
                                {post.data.group.id.toUpperCase()}
                            </span>
                        )}
                    </div>

                    <h3>{post.data.title}</h3>

                    <div class="authors">
                        {post.data.authors.length > 0 ? (
                            <span>by {post.data.authors.map(a => a.name).join(", ")}</span>
                        ) : (
                            <span class="mute">RITSEC</span>
                        )}
                    </div>

                </article>
            </a>
        ))
    }

    {featuredResearch.length === 0 && (
        <p class="no-data">No research papers found.</p>
    )}
</div>

<style>
    .research-grid {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        margin-top: 1rem;
    }

    .research-link {
        text-decoration: none;
        color: inherit;
        display: block;
    }

    .research-card {
        background-color: var(--bg-panel);
        border: 2px solid var(--border);
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .research-link:hover .research-card {
        border-color: var(--accent);
    }

    .card-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .mono-date {
        font-family: monospace;
        color: var(--fg-mute, #666);
        font-size: 0.9rem;
    }

    .group-badge {
        font-size: 0.75rem;
        font-weight: 700;
        color: var(--accent);
        border: 1px solid var(--accent);
        padding: 2px 6px;
        border-radius: 4px;
        letter-spacing: 0.05em;
    }

    h3 {
        font-size: 1.5rem;
        font-weight: 700;
        margin: 0;
        line-height: 1.3;
    }

    .authors {
        font-size: 0.9rem;
        color: var(--fg-mute);
        margin-top: auto; 
    }

    .no-data {
        text-align: center;
        padding: 2rem;
        font-style: italic;
        opacity: 0.7;
    }

    @media (max-width: 700px) {
        .research-card {
            padding: 1rem;
        }
        h3 {
            font-size: 1rem;
        }
    }

    @media (max-width: 1000px) {
        .card-meta {
            justify-content: center;
        }
    }
</style>
